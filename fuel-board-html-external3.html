<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‡ƒæ–™å˜ä¾¡æ²å‡ºãƒ„ãƒ¼ãƒ«</title>
    <link rel="stylesheet" href="fuel-board-styles.css">
</head>
<body>
    <div class="app-controls">
        <div class="store-selector">
            <label for="storeSelect">åº—èˆ—é¸æŠ:</label>
            <select id="storeSelect" class="store-dropdown">
                <option value="">èª­ã¿è¾¼ã¿ä¸­...</option>
            </select>
        </div>
        <div class="print-area">
            <span class="print-settings">å°åˆ·è¨­å®šï¼šA4ãƒ»å®Ÿéš›ã®ã‚µã‚¤ã‚ºãƒ»ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ãƒƒã‚¿ãƒ¼ãªã—ãƒ»èƒŒæ™¯ã‚ªãƒ³ã«ã—ã¦ãã ã•ã„</span>
            <button class="print-button" onclick="window.print()">
                ğŸ–¨ï¸ å°åˆ·
            </button>
        </div>
    </div>
    
    <div class="fuel-board">
        <div class="header">
            <div class="header-left">
                <div class="customer-greeting">ã”åˆ©ç”¨ã®ãŠå®¢æ§˜ã¸</div>
            </div>
            <div class="header-right">
                <div class="company-name">ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ <span id="storeName">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</span></div>
            </div>
        </div>
        
        <div class="notice-box">
            <div class="notice-small">ãŠè»Šã‚’ãŠè¿”ã—ã„ãŸã ãéš›ã¯ã€Œç‡ƒè²»ç²¾ç®—ã€ã‚’ã©ã†ã</div>
            <div class="notice-large">çµ¦æ²¹ã®æ‰‹é–“ãªã—ï¼åº—èˆ—ã§ãŠæ”¯æ‰•ã„ã„ãŸã ã‘ã¾ã™</div>
        </div>
        
        <div class="section-subtitle">ğŸš— ã‚¬ã‚½ãƒªãƒ³ä»£ã®ç²¾ç®—ã¯ã€Œç‡ƒè²»ç²¾ç®—ã€ã‚’ãŠã™ã™ã‚ã„ãŸã—ã¾ã™ã€‚</div>
        
        <div class="fuel-explanation">
            <div class="fuel-explanation-title">ğŸ“Š è»Šã®ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œå¹³å‡ç‡ƒè²»ã€ã‚’ä½¿ç”¨ã—ã¦ç‡ƒæ–™ä»£ã®ç²¾ç®—ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚</div>
            
            <div class="fuel-calculation">
                <div class="calculation-formula">
                    <div class="formula-item highlight">
                        <div class="formula-top">ç²¾ç®—é‡‘é¡</div>
                        <div class="formula-bottom">(ç‡ƒæ–™ä»£)</div>
                    </div>
                    <div class="formula-operator">=</div>
                    <div class="formula-item highlight2">
                        <div class="formula-top">èµ°è¡Œè·é›¢</div>
                        <div class="formula-bottom">(TRIP)</div>
                    </div>
                    <div class="formula-operator">Ã·</div>
                    <div class="formula-item highlight2">
                        <div class="formula-top">å¹³å‡ç‡ƒè²»</div>
                        <div class="formula-bottom high">(km/L)</div>
                    </div>
                    <div class="formula-operator">Ã—</div>
                    <div class="formula-item highlight2">
                        <div class="formula-top">ç‡ƒæ–™å˜ä¾¡</div>
                        <div class="formula-bottom">(1Lã‚ãŸã‚Š)</div>
                    </div>
                </div>
                
                <div class="warning-notes">
                    <div class="warning-note">ç‡ƒè²»ç²¾ç®—ã¯ã€Œå®Ÿæ–½å¯èƒ½ãªè»Šç¨®ã€ã‚„ã€Œé€”ä¸­çµ¦æ²¹ã«é–¢ã™ã‚‹æ³¨æ„äº‹é …ã€ãŒã”ã–ã„ã¾ã™ã€‚</div>
                    <div class="warning-note">åˆã‚ã¦ã”åˆ©ç”¨ã®å ´åˆã¯ã€å¿…ãšäº‹å‰ã«ã‚¹ã‚¿ãƒƒãƒ•ã¾ã§ãŠç”³ã—å‡ºãã ã•ã„ï¼</div>
                </div>
            </div>
        </div>
        
        <div class="price-header">
            <div class="section-subtitle">ğŸ’° å½“åº—ã®ç‡ƒæ–™å˜ä¾¡ã¯ã“ã¡ã‚‰ï¼ˆç¨è¾¼ä¾¡æ ¼ï¼‰</div>
            <div class="update-info" id="updateInfo"><strong>2025-07-15æ›´æ–°</strong></div>
        </div>
        
        <div class="price-section">
            <div class="fuel-type regular">
                <div class="fuel-label">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼</div>
                <div class="fuel-price">
                    <span id="regularPrice">177</span>
                    <span class="fuel-unit">å††/L</span>
                </div>
            </div>
            
            <div class="fuel-type diesel">
                <div class="fuel-label">è»½ æ²¹</div>
                <div class="fuel-price">
                    <span id="dieselPrice">157</span>
                    <span class="fuel-unit">å††/L</span>
                </div>
            </div>
        </div>
        
        <div class="reference-title">â›½ ç¾åœ¨ã€ä¸‹è¨˜ã‚¬ã‚½ãƒªãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã®ä¾¡æ ¼ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã¾ã™</div>
        
        <div class="reference-section">
            <div class="station-info">
                <div class="station-name" id="stationName">ENEOS åŒ—æœ¬åº„ SSï¼ˆåœŸå±‹çŸ³æ²¹ï¼‰</div>
                <div class="station-distance" id="stationDistance">å½“åº—ã‹ã‚‰0.9 km</div>
            </div>
            
            <div class="map-container">
                <div id="map" class="location-map" style="display: none;"></div>
                <div id="mapLoading" class="map-loading">
                    åœ°å›³ã‚’èª­ã¿è¾¼ã¿ä¸­...
                </div>
                <div class="map-legend">
                    <div class="legend-item">
                        <div class="legend-marker rental"></div>
                        <span id="legendStoreName">ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ç¦å±±é§…å‰åº—</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-marker gas"></div>
                        <span id="legendStationName">ENEOS åŒ—æœ¬åº„ SSï¼ˆåœŸå±‹çŸ³æ²¹ï¼‰</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script async defer 
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAGUorGUfy--oERdupd_6FoUQc-xFR5WbE&callback=initApp">
    </script>
    
    <script>
        let storesData = [];
        let map = null;
        let directionsService = null;
        let directionsRenderer = null;
        
        // æ–‡å­—åˆ—ãŒç·¯åº¦çµŒåº¦å½¢å¼ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°
        function isCoordinateFormat(str) {
            if (!str || typeof str !== 'string') return false;
            // ã€Œåºƒå³¶çœŒã€ãŒå«ã¾ã‚Œã¦ã„ãªã„å ´åˆã¯ç·¯åº¦çµŒåº¦ã¨ã¿ãªã™
            return !str.includes('åºƒå³¶çœŒ');
        }
        
        // åº¦åˆ†ç§’å½¢å¼ã®åº§æ¨™ã‚’åé€²æ•°ã«å¤‰æ›ã™ã‚‹é–¢æ•°
        function convertDMSToDecimal(dmsString) {
            try {
                // æ–‡å­—åˆ—ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆä½™åˆ†ãªæ–‡å­—ã‚’é™¤å»ï¼‰
                const cleanString = dmsString.trim().replace(/[""]$/, ''); // æœ«å°¾ã®ä½™åˆ†ãªå¼•ç”¨ç¬¦ã‚’é™¤å»
                console.log('å¤‰æ›å¯¾è±¡ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å¾Œï¼‰:', cleanString);
                
                // ä¾‹: "34Â°24'20.3"N 132Â°27'42.9"E" ã®å½¢å¼ã‚’è§£æ
                const regex = /(\d+)Â°(\d+)'([\d.]+)"?([NSEW])\s+(\d+)Â°(\d+)'([\d.]+)"?([NSEW])/;
                const match = cleanString.match(regex);
                
                if (!match) {
                    console.error('åº§æ¨™å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“:', cleanString);
                    return null;
                }
                
                // ç·¯åº¦ã®è¨ˆç®—
                const latDeg = parseInt(match[1]);
                const latMin = parseInt(match[2]);
                const latSec = parseFloat(match[3]);
                const latDir = match[4];
                let lat = latDeg + (latMin / 60) + (latSec / 3600);
                if (latDir === 'S') lat = -lat;
                
                // çµŒåº¦ã®è¨ˆç®—
                const lngDeg = parseInt(match[5]);
                const lngMin = parseInt(match[6]);
                const lngSec = parseFloat(match[7]);
                const lngDir = match[8];
                let lng = lngDeg + (lngMin / 60) + (lngSec / 3600);
                if (lngDir === 'W') lng = -lng;
                
                console.log('å¤‰æ›çµæœ:', { lat: lat, lng: lng });
                return { lat: lat, lng: lng };
            } catch (error) {
                console.error('åº§æ¨™å¤‰æ›ã‚¨ãƒ©ãƒ¼:', error, 'Input:', dmsString);
                return null;
            }
        }
        
        // 2ç‚¹é–“ã®è·é›¢ã‚’è¨ˆç®—ï¼ˆãƒãƒãƒ¼ã‚µã‚¤ãƒ³å…¬å¼ï¼‰
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // åœ°çƒã®åŠå¾„ï¼ˆkmï¼‰
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return distance;
        }
        
        // CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
        async function loadStoresData() {
            try {
                const response = await fetch('./fuel_prices.csv');
                const csvText = await response.text();
                
                // CSVã‚’ãƒ‘ãƒ¼ã‚¹ï¼ˆç°¡æ˜“ç‰ˆï¼‰
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                
                storesData = lines.slice(1).map(line => {
                    const values = line.split(',');
                    const store = {};
                    headers.forEach((header, index) => {
                        store[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    return store;
                });
                
                populateStoreSelector();
                
            } catch (error) {
                console.error('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('storeSelect').innerHTML = '<option value="">CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>';
            }
        }
        
        // åº—èˆ—é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’æ§‹ç¯‰
        function populateStoreSelector() {
            const select = document.getElementById('storeSelect');
            select.innerHTML = '<option value="">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            
            storesData.forEach((store, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = store['åº—èˆ—å'];
                select.appendChild(option);
            });
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é¸æŠï¼ˆä¿®æ­£ï¼‰
            if (storesData.length > 0) {
                // æœ€åˆã®åº—èˆ—ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§é¸æŠ
                select.value = 0;
                updateStoreDisplay(0);
            }
        }
        
        // åº—èˆ—è¡¨ç¤ºã‚’æ›´æ–°
        function updateStoreDisplay(storeIndex) {
            if (storeIndex === '' || !storesData[storeIndex]) return;
            
            const store = storesData[storeIndex];
            
            // åŸºæœ¬æƒ…å ±ã‚’æ›´æ–°
            document.getElementById('storeName').textContent = store['åº—èˆ—å'];
            document.getElementById('updateInfo').innerHTML = `<strong>${store['æ›´æ–°æ—¥']}æ›´æ–°</strong>`;
            document.getElementById('regularPrice').textContent = store['ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼å˜ä¾¡'];
            document.getElementById('dieselPrice').textContent = store['è»½æ²¹å˜ä¾¡'];
            document.getElementById('stationName').textContent = store['ã‚¹ã‚¿ãƒ³ãƒ‰å'];
            document.getElementById('legendStoreName').textContent = `ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼${store['åº—èˆ—å']}`;
            document.getElementById('legendStationName').textContent = store['ã‚¹ã‚¿ãƒ³ãƒ‰å'];
            
            // åœ°å›³ã‚’æ›´æ–°ï¼ˆç·¯åº¦çµŒåº¦ã‚’ä½¿ç”¨ï¼‰
            updateMapWithCoordinates(store['åº—èˆ—ä½æ‰€'], store['ç·¯åº¦çµŒåº¦'], store['åº—èˆ—å'], store['ã‚¹ã‚¿ãƒ³ãƒ‰å']);
        }
        
        // åœ°å›³ã‚’åº§æ¨™æƒ…å ±ã§æ›´æ–°ï¼ˆä½æ‰€ãƒ»ç·¯åº¦çµŒåº¦ä¸¡å¯¾å¿œï¼‰
        function updateMapWithCoordinates(storeAddress, stationCoordinates, storeName, stationName) {
            if (!map) {
                console.error('åœ°å›³ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            console.log('åœ°å›³æ›´æ–°é–‹å§‹:', { storeAddress, stationCoordinates, storeName, stationName });
            
            try {
                // ã‚¬ã‚½ãƒªãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã®åº§æ¨™ã‚’å‡¦ç†
                let stationPosition;
                if (isCoordinateFormat(stationCoordinates)) {
                    // ç·¯åº¦çµŒåº¦å½¢å¼ã®å ´åˆ
                    const stationLatLng = convertDMSToDecimal(stationCoordinates);
                    if (!stationLatLng) {
                        console.error('ã‚¬ã‚½ãƒªãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã®åº§æ¨™å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸ:', stationCoordinates);
                        document.getElementById('stationDistance').textContent = 'ã‚¹ã‚¿ãƒ³ãƒ‰åº§æ¨™å¤‰æ›ã‚¨ãƒ©ãƒ¼';
                        return;
                    }
                    stationPosition = new google.maps.LatLng(stationLatLng.lat, stationLatLng.lng);
                    console.log('ã‚¹ã‚¿ãƒ³ãƒ‰ä½ç½®ï¼ˆç·¯åº¦çµŒåº¦ï¼‰:', stationLatLng);
                } else {
                    // ä½æ‰€å½¢å¼ã®å ´åˆ
                    stationPosition = stationCoordinates;
                    console.log('ã‚¹ã‚¿ãƒ³ãƒ‰ä½ç½®ï¼ˆä½æ‰€ï¼‰:', stationCoordinates);
                }
                
                // åº—èˆ—ã®åº§æ¨™ã‚’å‡¦ç†
                let storePosition;
                if (isCoordinateFormat(storeAddress)) {
                    // ç·¯åº¦çµŒåº¦å½¢å¼ã®å ´åˆ
                    const storeLatLng = convertDMSToDecimal(storeAddress);
                    if (!storeLatLng) {
                        console.error('åº—èˆ—ã®åº§æ¨™å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸ:', storeAddress);
                        document.getElementById('stationDistance').textContent = 'åº—èˆ—åº§æ¨™å¤‰æ›ã‚¨ãƒ©ãƒ¼';
                        return;
                    }
                    storePosition = new google.maps.LatLng(storeLatLng.lat, storeLatLng.lng);
                    console.log('åº—èˆ—ä½ç½®ï¼ˆç·¯åº¦çµŒåº¦ï¼‰:', storeLatLng);
                } else {
                    // ä½æ‰€å½¢å¼ã®å ´åˆ
                    storePosition = storeAddress;
                    console.log('åº—èˆ—ä½ç½®ï¼ˆä½æ‰€ï¼‰:', storeAddress);
                }
                
                // Directions Service ã§ãƒ«ãƒ¼ãƒˆã‚’è¨ˆç®—
                console.log('ãƒ«ãƒ¼ãƒˆè¨ˆç®—é–‹å§‹...');
                directionsService.route({
                    origin: storePosition,
                    destination: stationPosition,
                    travelMode: google.maps.TravelMode.DRIVING,
                    avoidHighways: false,
                    avoidTolls: false
                }, (response, status) => {
                    console.log('ãƒ«ãƒ¼ãƒˆè¨ˆç®—çµæœ:', status);
                    if (status === 'OK') {
                        directionsRenderer.setDirections(response);
                        
                        // è·é›¢æƒ…å ±ã‚’æ›´æ–°
                        const route = response.routes[0];
                        const leg = route.legs[0];
                        const distance = leg.distance.text;
                        
                        document.getElementById('stationDistance').textContent = `å½“åº—ã‹ã‚‰${distance}`;
                        
                        // ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ã®ä½ç½®ã‚’è¨­å®š
                        if (window.startMarker && window.endMarker) {
                            window.startMarker.setPosition(leg.start_location);
                            window.endMarker.setPosition(leg.end_location);
                        }
                        
                        // èª­ã¿è¾¼ã¿å®Œäº†
                        document.getElementById('mapLoading').style.display = 'none';
                        document.getElementById('map').style.display = 'block';
                        console.log('åœ°å›³è¡¨ç¤ºå®Œäº†');
                    } else {
                        console.error('Directions request failed due to ' + status);
                        document.getElementById('stationDistance').textContent = 'ãƒ«ãƒ¼ãƒˆè¨ˆç®—ã‚¨ãƒ©ãƒ¼: ' + status;
                        
                        // ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯åº§æ¨™ã‹ã‚‰ç›´æ¥è·é›¢è¨ˆç®—ã‚’è©¦è¡Œ
                        fallbackWithBothCoordinates(storePosition, stationPosition);
                    }
                });
                
            } catch (error) {
                console.error('åœ°å›³æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('stationDistance').textContent = 'åœ°å›³æ›´æ–°ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šä¸¡æ–¹ã®åº§æ¨™ã‚’å‡¦ç†ã—ã¦è·é›¢è¨ˆç®—
        function fallbackWithBothCoordinates(storePosition, stationPosition) {
            const geocoder = new google.maps.Geocoder();
            let storeLatLng = null;
            let stationLatLng = null;
            
            // åº—èˆ—ä½ç½®ã®å‡¦ç†
            const processStorePosition = () => {
                return new Promise((resolve) => {
                    if (storePosition instanceof google.maps.LatLng) {
                        storeLatLng = storePosition;
                        resolve();
                    } else {
                        geocoder.geocode({ 'address': storePosition }, (results, status) => {
                            if (status === 'OK') {
                                storeLatLng = results[0].geometry.location;
                            }
                            resolve();
                        });
                    }
                });
            };
            
            // ã‚¬ã‚½ãƒªãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ä½ç½®ã®å‡¦ç†
            const processStationPosition = () => {
                return new Promise((resolve) => {
                    if (stationPosition instanceof google.maps.LatLng) {
                        stationLatLng = stationPosition;
                        resolve();
                    } else {
                        geocoder.geocode({ 'address': stationPosition }, (results, status) => {
                            if (status === 'OK') {
                                stationLatLng = results[0].geometry.location;
                            }
                            resolve();
                        });
                    }
                });
            };
            
            // ä¸¡æ–¹ã®ä½ç½®ã‚’å‡¦ç†ã—ã¦ã‹ã‚‰è·é›¢è¨ˆç®—
            Promise.all([processStorePosition(), processStationPosition()]).then(() => {
                if (storeLatLng && stationLatLng) {
                    const distance = calculateDistance(
                        storeLatLng.lat(), storeLatLng.lng(),
                        stationLatLng.lat(), stationLatLng.lng()
                    );
                    document.getElementById('stationDistance').textContent = `å½“åº—ã‹ã‚‰ç´„${distance.toFixed(1)} km`;
                    
                    // ãƒãƒ¼ã‚«ãƒ¼ã‚’é…ç½®
                    if (window.startMarker && window.endMarker) {
                        window.startMarker.setPosition(storeLatLng);
                        window.endMarker.setPosition(stationLatLng);
                    }
                    
                    // åœ°å›³ã®è¡¨ç¤ºç¯„å›²ã‚’èª¿æ•´
                    const bounds = new google.maps.LatLngBounds();
                    bounds.extend(storeLatLng);
                    bounds.extend(stationLatLng);
                    map.fitBounds(bounds);
                } else {
                    document.getElementById('stationDistance').textContent = 'ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
                }
                
                document.getElementById('mapLoading').style.display = 'none';
                document.getElementById('map').style.display = 'block';
            });
        }
        
        // Google MapsåˆæœŸåŒ–
        function initMap() {
            // åœ°å›³ã®åˆæœŸåŒ–
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: { lat: 34.4087, lng: 132.4733 },
                mapTypeId: 'roadmap',
                disableDefaultUI: true,
                zoomControl: true,
                gestureHandling: 'cooperative'
            });
            
            // åœ°å›³ã®é«˜ã•ã‚’æ˜ç¤ºçš„ã«è¨­å®š
            document.getElementById('map').style.height = '300px';
            
            // Directions Service ã¨Renderer ã®ä½œæˆ
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                polylineOptions: {
                    strokeColor: '#1976d2',
                    strokeWeight: 4,
                    strokeOpacity: 1.0
                },
                suppressMarkers: true
            });
            
            directionsRenderer.setMap(map);
            
            // ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆ
            window.startMarker = new google.maps.Marker({
                position: null,
                map: map,
                title: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼åº—èˆ—',
                icon: {
                    url: './rental-car-icon.svg',
                    scaledSize: new google.maps.Size(40, 40),
                    anchor: new google.maps.Point(20, 20)
                }
            });
            
            window.endMarker = new google.maps.Marker({
                position: null,
                map: map,
                title: 'ã‚¬ã‚½ãƒªãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰',
                icon: {
                    url: './gas-station-icon.svg',
                    scaledSize: new google.maps.Size(32, 32),
                    anchor: new google.maps.Point(16, 16)
                }
            });
            
            // åœ°å›³ã®ãƒªã‚µã‚¤ã‚ºã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼
            google.maps.event.trigger(map, 'resize');
        }
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        function initApp() {
            initMap();
            loadStoresData();
            
            // åº—èˆ—é¸æŠã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('storeSelect').addEventListener('change', function() {
                const storeIndex = this.value;
                updateStoreDisplay(storeIndex);
            });
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.gm_authFailure = function() {
            document.getElementById('mapLoading').innerHTML = 'Google Maps APIã‚­ãƒ¼ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„';
        };
    </script>
</body>
</html>